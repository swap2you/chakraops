# Release R22.4 — Multi-timeframe S/R + hold-time (request-time only)

**Date:** 2026-02  
**Goal:** On Symbol page show M/W/D (optional 4H) S/R, methodology, targets, invalidation, and hold-time estimate with basis key; all request-time, not persisted in decision JSON.

---

## Scope

- **In scope:** Request-time API fields in GET `/api/ui/symbol-diagnostics`: mtf_levels (monthly, weekly, daily, 4h), methodology (candles_source, window, clustering_tolerance_pct, active_criteria), targets (t1/t2/t3), invalidation, hold_time_estimate (sessions, basis_key). Symbol page: Multi-timeframe levels table, methodology note, Targets and hold-time card, hold_time_estimate with basis_key to label mapping. No mtf_levels or free-text persisted in decision_latest.json.
- **Out of scope:** Changing decision schema; persisting MTF in decision store; 4H data source (currently null).

---

## API changes

| Method | Path | Description |
|--------|------|-------------|
| GET | `/api/ui/symbol-diagnostics?symbol=` | Response includes mtf_levels (per timeframe: support, resistance, as_of, method), methodology, targets, invalidation, hold_time_estimate (sessions, basis_key). All request-time only. |

---

## UI changes

- Symbol Diagnostics page: Multi-timeframe levels card (table: Timeframe, Support, Resistance, as_of, method); methodology summary; Targets and hold-time card (T1/T2/T3, invalidation, hold-time with mapped basis label). No raw FAIL_* in these sections.

---

## Data / persistence

- decision_latest.json unchanged; no mtf_levels or new free-text persisted.

---

## Tests

- Backend: _build_mtf_levels_at_request_time, _build_hold_time_estimate_at_request_time used in _build_symbol_diagnostics_from_v2_store.
- Frontend: SymbolDiagnosticsPage R22.4 MTF levels and hold-time tests; holdTimeBasisLabel mapping.

---

## Verification

- UAT evidence path: `out/verification/R22.4/notes.md`, `out/verification/R22.4/api_samples/`.

---

## File list (summary)

- `chakraops/app/api/ui_routes.py` — _build_mtf_levels_at_request_time, _build_hold_time_estimate_at_request_time, mtf_levels, methodology, targets, invalidation, hold_time_estimate in response.
- `frontend/src/api/types.ts` — mtf_levels, methodology, targets, invalidation, hold_time_estimate types.
- `frontend/src/pages/SymbolDiagnosticsPage.tsx` — Multi-timeframe levels panel, Targets and hold-time, holdTimeBasisLabel.
- `out/verification/R22.4/notes.md`, `out/verification/R22.4/api_samples/symbol_diagnostics_mtf_sample.json`.
